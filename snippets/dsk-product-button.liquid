{% comment %}
  DSK Credit API – бутон за покупка на изплащане.
  Показва се само ако dskapi_status е включен и dskapi_cid е попълнен (не празно).
{% endcomment %}

{% assign show_dskapi = false %}
{% if settings.dskapi_status and settings.dskapi_cid != blank %}
  {% comment %} Проверка за валута - показваме бутона само ако магазинът работи с EUR {% endcomment %}
  {% if shop.currency == 'EUR' %}
    {% assign show_dskapi = true %}
  {% endif %}
{% endif %}

{% if show_dskapi %}
  {% assign gap = settings.dskapi_gap | default: 0 %}
  {% if gap < 0 %}{% assign gap = 0 %}{% endif %}

  {% comment %} Получаване на данни за продукта {% endcomment %}
  {% assign product_id = product.id | default: '' %}
  {% assign product_title = product.title | default: '' %}
  {% comment %} Цената в Shopify е в стотинки, затова разделяме на 100 {% endcomment %}
  {% assign product_price_cents = product.selected_or_first_available_variant.price
    | default: product.price
    | default: 0
  %}
  {% assign product_price = product_price_cents | divided_by: 100.0 %}
  {% assign product_variant_id = product.selected_or_first_available_variant.id | default: '' %}
  {% assign shop_domain = shop.domain | default: '' %}
  {% assign shop_permanent_domain = shop.permanent_domain | default: '' %}

  {{ 'dsk-product-button.css' | asset_url | stylesheet_tag }}
  <script src="{{ 'dsk-product-button.js' | asset_url }}" defer></script>

  <div
    id="dskapi-product-button-container"
    style="margin-top: {{ gap }}px;"
    data-product-id="{{ product_id }}"
    data-product-title="{{ product_title | escape }}"
    data-product-price="{{ product_price }}"
    data-product-variant-id="{{ product_variant_id }}"
    data-shop-domain="{{ shop_domain }}"
    data-shop-permanent-domain="{{ shop_permanent_domain }}"
    data-cid="{{ settings.dskapi_cid }}"
  >
    <button type="button" id="btn_dskapi" class="button button-secondary">
      <span class="dskapi-btn-text">Купи на кредит от</span>
      <span class="dskapi-btn-logo">
        <img
          src="{{ 'dsk-logo-color.svg' | asset_url }}"
          alt="Банка ДСК покупки на Кредит"
          width="120"
          height="20"
        >
      </span>
    </button>
  </div>
{% endif %}

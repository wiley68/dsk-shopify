{% comment %}
  DSK Credit API – бутон за покупка на изплащане.
  Показва се само ако dskapi_status е включен и dskapi_cid е попълнен (не празно).
{% endcomment %}

{% assign show_dskapi = false %}
{% if settings.dskapi_status and settings.dskapi_cid != blank %}
  {% assign show_dskapi = true %}
{% endif %}

{% if show_dskapi %}
  {% assign gap = settings.dskapi_gap | default: 0 %}
  {% if gap < 0 %}{% assign gap = 0 %}{% endif %}

  {% comment %} Получаване на данни за продукта {% endcomment %}
  {% assign product_id = product.id | default: '' %}
  {% assign product_title = product.title | default: '' %}
  {% assign product_price = product.selected_or_first_available_variant.price | default: product.price | default: 0 %}
  {% assign product_variant_id = product.selected_or_first_available_variant.id | default: '' %}
  {% assign shop_domain = shop.domain | default: shop.permanent_domain | default: '' %}

  {{ 'dsk-product-button.css' | asset_url | stylesheet_tag }}
  {{ 'dsk-product-button.js' | asset_url | script_tag }}

  <div
    id="dskapi-product-button-container"
    style="margin-top: {{ gap }}px;"
    data-product-id="{{ product_id }}"
    data-product-title="{{ product_title | escape }}"
    data-product-price="{{ product_price }}"
    data-product-variant-id="{{ product_variant_id }}"
    data-shop-domain="{{ shop_domain }}"
    data-cid="{{ settings.dskapi_cid }}"
  >
    <button type="button" id="btn_dskapi" class="button button-secondary">
      <span class="dskapi-btn-text">Купи на кредит от</span>
      <span class="dskapi-btn-logo">
        <img
          src="{{ 'dsk-logo-color.svg' | asset_url }}"
          alt="Банка ДСК покупки на Кредит"
        >
      </span>
    </button>
  </div>
{% endif %}
